<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>flame_utils.viz.plotlat &mdash; flame-utils  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/frib-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> flame-utils
          </a>
              <div class="version">
                0.4.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../element.html">Lattice Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../beamstate.html">BeamState Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelflame.html">ModelFlame Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plotlat.html">Plot function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">Application Programming Interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">flame-utils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>flame_utils.viz.plotlat</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for flame_utils.viz.plotlat</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;This module provides lattice picture from FLAME lattice file(.lat) or FLAME Machine object.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">flame</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">flame_utils.core</span> <span class="kn">import</span> <span class="n">ModelFlame</span>
<span class="kn">from</span> <span class="nn">flame_utils.core</span> <span class="kn">import</span> <span class="n">BeamState</span>
<span class="kn">from</span> <span class="nn">flame_utils.io</span> <span class="kn">import</span> <span class="n">collect_data</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">lin</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">ptc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="hplot"><a class="viewcode-back" href="../../../plotlat.html#flame_utils.hplot">[docs]</a><span class="k">def</span> <span class="nf">hplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot beam state history with input arguments.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    machine : object</span>
<span class="sd">        FLAME machine or ModelFlame object.</span>
<span class="sd">    result :</span>
<span class="sd">        List of beam state, generated by Machine.propagete() or ModelFlame.run() method.</span>
<span class="sd">    args : str</span>
<span class="sd">        Beam state attributes to plot, seprated by comma. (see Note)</span>
<span class="sd">    colors : dict</span>
<span class="sd">        Color definition of each ``args``.</span>
<span class="sd">    lattice : bool</span>
<span class="sd">        Plot lattice layout.</span>
<span class="sd">    legend : bool</span>
<span class="sd">        Plot legend of ``args``</span>
<span class="sd">    cs : int</span>
<span class="sd">        Index of the charge state to plot.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    List of supported :py:func:`BeamState &lt;flame_utils.core.state.BeamState&gt;` arguments</span>

<span class="sd">    pos : float</span>
<span class="sd">        Longitudinally propagating position, [m].</span>
<span class="sd">    ref_beta : float</span>
<span class="sd">        Speed in the unit of light velocity in vacuum of reference charge</span>
<span class="sd">        state, Lorentz beta.</span>
<span class="sd">    ref_bg : float</span>
<span class="sd">        Multiplication of beta and gamma of reference charge state.</span>
<span class="sd">    ref_gamma : float</span>
<span class="sd">        Relativistic energy of reference charge state, Lorentz gamma.</span>
<span class="sd">    ref_IonEk : float</span>
<span class="sd">        Kinetic energy of reference charge state, [eV/u].</span>
<span class="sd">    ref_IonEs : float</span>
<span class="sd">        Rest energy of reference charge state, [eV/u].</span>
<span class="sd">    ref_IonQ : int</span>
<span class="sd">        Macro particle number of reference charge state.</span>
<span class="sd">    ref_IonW : float</span>
<span class="sd">        Total energy of reference charge state, [eV/u],</span>
<span class="sd">        i.e. :math:`W = E_s + E_k`.</span>
<span class="sd">    ref_IonZ : float</span>
<span class="sd">        Reference charge to mass ratio, e.g.</span>
<span class="sd">        :math:`^{33^{+}}_{238}U: Q[33]/A[238]`.</span>
<span class="sd">    ref_phis : float</span>
<span class="sd">        Absolute synchrotron phase of reference charge state, [rad].</span>
<span class="sd">    ref_SampleIonK : float</span>
<span class="sd">        Wave-vector in cavities with different beta values of reference charge</span>
<span class="sd">        state.</span>
<span class="sd">    beta : Array</span>
<span class="sd">        Speed in the unit of light velocity in vacuum of all charge states,</span>
<span class="sd">        Lorentz beta.</span>
<span class="sd">    bg : Array</span>
<span class="sd">        Multiplication of beta and gamma of all charge states.</span>
<span class="sd">    gamma : Array</span>
<span class="sd">        Relativistic energy of all charge states, Lorentz gamma.</span>
<span class="sd">    IonEk : Array</span>
<span class="sd">        Kinetic energy of all charge states, [eV/u].</span>
<span class="sd">    IonEs : Array</span>
<span class="sd">        Rest energy of all charge states, [eV/u].</span>
<span class="sd">    IonQ : Array</span>
<span class="sd">        Macro particle number of all charge states.</span>
<span class="sd">    IonW : Array</span>
<span class="sd">        Total energy of all charge states, [eV/u], i.e. :math:`W = E_s + E_k`.</span>
<span class="sd">    IonZ : Array</span>
<span class="sd">        All charge to mass ratios</span>
<span class="sd">    phis : Array</span>
<span class="sd">        Absolute synchrotron phase of all charge states, [rad]</span>
<span class="sd">    SampleIonK : Array</span>
<span class="sd">        Wave-vector in cavities with different beta values of all charge</span>
<span class="sd">        states.</span>
<span class="sd">    x0_env, xcen : float</span>
<span class="sd">        Weight average of all charge states for x&#39;, [rad].</span>
<span class="sd">    y0_env, ycen : float</span>
<span class="sd">        Weight average of all charge states for y, [mm].</span>
<span class="sd">    xp0_env, xpcen : float</span>
<span class="sd">        Weight average of all charge states for x&#39;, [rad].</span>
<span class="sd">    yp0_env, ypcen : float</span>
<span class="sd">        Weight average of all charge states for y&#39;, [rad].</span>
<span class="sd">    phi0_env, phicen, zcen: float</span>
<span class="sd">        Weight average of all charge states for :math:`\phi`, [rad].</span>
<span class="sd">    dEk0_env, dEkcen, zpcen : float</span>
<span class="sd">        Weight average of all charge states for :math:`\delta E_k`, [MeV/u].</span>
<span class="sd">    x0, xcen_all : Array</span>
<span class="sd">        X centroid for all charge states, [mm].</span>
<span class="sd">    y0, ycen_all : Array</span>
<span class="sd">        Y centroid for all charge states, [mm].</span>
<span class="sd">    xp0, xpcen_all : Array</span>
<span class="sd">        X centroid divergence for all charge states, [rad].</span>
<span class="sd">    yp0, ypcen_all : Array</span>
<span class="sd">        Y centroid divergence for all charge states, [rad].</span>
<span class="sd">    phi0, phicen_all, zcen_all : Array</span>
<span class="sd">        Longitudinal beam length, measured in RF frequency for all charge</span>
<span class="sd">        states, [rad].</span>
<span class="sd">    dEk0, dEkcen_all, zpcen_all : Array</span>
<span class="sd">        Kinetic energy deviation w.r.t. reference charge state, for all charge</span>
<span class="sd">        states, [MeV/u].</span>
<span class="sd">    x0_rms, xrms : float</span>
<span class="sd">        General rms beam envelope for x, [mm].</span>
<span class="sd">    y0_rms, yrms : float</span>
<span class="sd">        General rms beam envelope for y, [mm].</span>
<span class="sd">    xp0_rms, xprms : float</span>
<span class="sd">        General rms beam envelope for x&#39;, [rad].</span>
<span class="sd">    yp0_rms, yprms : float</span>
<span class="sd">        General rms beam envelope for y&#39;, [rad].</span>
<span class="sd">    phi0_rms, phirms, zrms : float</span>
<span class="sd">        General rms beam envelope for :math:`\phi`, [rad].</span>
<span class="sd">    dEk0_rms, dEkrms, zprms : float</span>
<span class="sd">        General rms beam envelope for :math:`\delta E_k`, [MeV/u].</span>
<span class="sd">    xrms_all : Array</span>
<span class="sd">        General rms beam envelope for x of all charge states, [mm].</span>
<span class="sd">    yrms_all : Array</span>
<span class="sd">        General rms beam envelope for y of all charge states, [mm].</span>
<span class="sd">    xprms_all : Array</span>
<span class="sd">        General rms beam envelope for x&#39; of all charge states, [rad].</span>
<span class="sd">    yprms_all : Array</span>
<span class="sd">        General rms beam envelope for y&#39; of all charge states, [rad].</span>
<span class="sd">    phirms_all : Array</span>
<span class="sd">        General rms beam envelope for :math:`\phi` of all charge states, [rad].</span>
<span class="sd">    dEkrms_all : Array</span>
<span class="sd">        General rms beam envelope for :math:`\delta E_k` of all charge states, [MeV/u].</span>
<span class="sd">    moment0_env, cenvector : Array</span>
<span class="sd">        Weight average of centroid for all charge states, array of</span>
<span class="sd">        ``[x, x&#39;, y, y&#39;, phi, dEk, 1]``, with the units of</span>
<span class="sd">        ``[mm, rad, mm, rad, rad, MeV/u, 1]``.</span>
<span class="sd">    moment0, cenvector_all : Array</span>
<span class="sd">        Centroid for all charge states, array of ``[x, x&#39;, y, y&#39;, phi, dEk, 1]``.</span>
<span class="sd">    moment0_rms, rmsvector : Array</span>
<span class="sd">        RMS beam envelope, part of statistical results from ``moment1``.</span>
<span class="sd">    moment1, beammatrix_all : Array</span>
<span class="sd">        Covariance matrices of all charge states, for each charge state.</span>
<span class="sd">    moment1_env, beammatrix : Array</span>
<span class="sd">        Covariance matrices of all charge states, average over all charge states.</span>
<span class="sd">    xemittance, xeps : float</span>
<span class="sd">        Weight average of geometrical x emittance, [mm-mrad].</span>
<span class="sd">    yemittance, yeps : float</span>
<span class="sd">        Weight average of geometrical y emittance, [mm-mrad].</span>
<span class="sd">    zemittance, zeps : float</span>
<span class="sd">        Weight average of geometrical z emittance, [rad-MeV/u].</span>
<span class="sd">    xnemittance, xepsn : float</span>
<span class="sd">        Weight average of normalized x emittance, [mm-mrad].</span>
<span class="sd">    ynemittance, yepsn : float</span>
<span class="sd">        Weight average of normalized y emittance, [mm-mrad].</span>
<span class="sd">    znemittance, zepsn : float</span>
<span class="sd">        Weight average of normalized z emittance, [rad-MeV/u].</span>
<span class="sd">    xemittance_all, xeps_all : Array</span>
<span class="sd">        Geometrical x emittance of all charge states, [mm-mrad].</span>
<span class="sd">    yemittance_all, yeps_all : Array</span>
<span class="sd">        Geometrical y emittance of all charge states, [mm-mrad].</span>
<span class="sd">    zemittance_all, zeps_all : Array</span>
<span class="sd">        Geometrical z emittance of all charge states, [rad-MeV/u].</span>
<span class="sd">    xnemittance_all, xepsn_all : Array</span>
<span class="sd">        Normalized x emittance of all charge states, [mm-mrad].</span>
<span class="sd">    ynemittance_all, yepsn_all : Array</span>
<span class="sd">        Normalized y emittance of all charge states, [mm-mrad].</span>
<span class="sd">    znemittance_all, zepsn_all : Array</span>
<span class="sd">        Normalized z emittance of all charge states, [rad-MeV/u].</span>
<span class="sd">    xtwiss_beta, xtwsb : float</span>
<span class="sd">        Weight average of twiss beta x, [m/rad].</span>
<span class="sd">    ytwiss_beta, ytwsb : float</span>
<span class="sd">        Weight average of twiss beta y, [m/rad].</span>
<span class="sd">    ztwiss_beta, ztwsb : float</span>
<span class="sd">        Weight average of twiss beta z, [rad/MeV/u].</span>
<span class="sd">    xtwiss_alpha, xtwsa : float</span>
<span class="sd">        Weight average of twiss alpha x, [1].</span>
<span class="sd">    ytwiss_alpha, ytwsa : float</span>
<span class="sd">        Weight average of twiss alpha y, [1].</span>
<span class="sd">    ztwiss_alpha, ztwsa : float</span>
<span class="sd">        Weight average of twiss alpha z, [1].</span>
<span class="sd">    xtwiss_beta_all, xtwsb_all : Array</span>
<span class="sd">        Twiss beta x of all charge states, [m/rad].</span>
<span class="sd">    ytwiss_beta_all, ytwsb_all : Array</span>
<span class="sd">        Twiss beta y of all charge states, [m/rad].</span>
<span class="sd">    ztwiss_beta_all, ztwsb_all : Array</span>
<span class="sd">        Twiss beta z of all charge states, [rad/MeV/u].</span>
<span class="sd">    xtwiss_alpha_all, xtwsa_all : Array</span>
<span class="sd">        Twiss alpha x of all charge states, [1].</span>
<span class="sd">    ytwiss_alpha_all, ytwsa_all : Array</span>
<span class="sd">        Twiss alpha y of all charge states, [1].</span>
<span class="sd">    ztwiss_alpha_all, ztwsa_all : Array</span>
<span class="sd">        Twiss alpha z of all charge states, [1].</span>
<span class="sd">    couple_xy, cxy : float</span>
<span class="sd">        Weigth average of normalized x-y coupling term, [1].</span>
<span class="sd">    couple_xpy, cxpy : float</span>
<span class="sd">        Weigth average of normalized xp-y coupling term, [1].</span>
<span class="sd">    couple_xyp, cxyp : float</span>
<span class="sd">        Weigth average of normalized x-yp coupling term, [1].</span>
<span class="sd">    couple_xpyp, cxpyp : float</span>
<span class="sd">        Weigth average of normalized xp-yp coupling term, [1].</span>
<span class="sd">    couple_xy_all, cxy_all : Array</span>
<span class="sd">        Normalized x-y coupling term of all charge states, [1].</span>
<span class="sd">    couple_xpy_all, cxpy_all : Array</span>
<span class="sd">        Normalized xp-y coupling term of all charge states, [1].</span>
<span class="sd">    couple_xyp_all, cxyp_all : Array</span>
<span class="sd">        Normalized x-yp coupling term of all charge states, [1].</span>
<span class="sd">    couple_xpyp_all, cxpyp_all : Array</span>
<span class="sd">        Normalized xp-yp coupling term of all charge states, [1].</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; fm = ModelFlame(lat_file = &#39;userfile.lat&#39;)</span>
<span class="sd">    &gt;&gt;&gt; hplot(&#39;xrms&#39;, &#39;yrms&#39;, machine=fm)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ldct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rms&#39;</span><span class="p">:</span> <span class="s1">&#39;RMS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cen&#39;</span><span class="p">:</span> <span class="s1">&#39;centroid&#39;</span><span class="p">,</span>
            <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;geom. emittance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;epsn&#39;</span><span class="p">:</span> <span class="s1">&#39;norm. emittance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;twsb&#39;</span><span class="p">:</span> <span class="s1">&#39;twiss beta&#39;</span><span class="p">,</span>
            <span class="s1">&#39;twsa&#39;</span><span class="p">:</span> <span class="s1">&#39;twiss alpha&#39;</span><span class="p">}</span>
    <span class="n">cdct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;colors&#39;</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]:</span>
            <span class="n">cdct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
    <span class="n">lsls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">]</span>
    <span class="n">lttc</span>  <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;lattice&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;lattice&#39;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="n">lgnd</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;legend&#39;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;cs&#39;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;machine&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;machine&#39;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ModelFlame</span><span class="p">(</span><span class="n">lat_file</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Nothing to plot.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Machine</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">allocState</span><span class="p">({})</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">observe</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ModelFlame</span><span class="p">):</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">monitor</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">bmstate</span><span class="p">)]</span> <span class="o">+</span> <span class="n">r</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">machine</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unsuported type of machine.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Machine</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ModelFlame</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">machine</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unsuported type of machine.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">collect_data</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">cs</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">lttc</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e256</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="mf">1e256</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">ymax</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])])</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])])</span>
            <span class="n">ydif</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span>
            <span class="n">yscl</span> <span class="o">=</span> <span class="n">ydif</span>
            <span class="k">if</span> <span class="n">ydif</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">ydif</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">*</span><span class="mf">0.1</span> <span class="k">if</span> <span class="n">ymax</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="mf">0.1</span>
                <span class="n">yscl</span> <span class="o">=</span> <span class="n">ydif</span><span class="o">*</span><span class="mf">0.2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ydif</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">yscl</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">PlotLat</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">auto_scaling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">l</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ycen</span><span class="o">=</span><span class="n">ymin</span><span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">ydif</span><span class="p">,</span> <span class="n">yscl</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">yscl</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">cntx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">cnty</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">cntz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">cnto</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cdct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cdct</span> <span class="k">else</span> <span class="n">cdct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">cntx</span> <span class="o">=</span> <span class="p">(</span><span class="n">cntx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cdct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cdct</span> <span class="k">else</span> <span class="n">cdct</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnty</span> <span class="o">=</span> <span class="p">(</span><span class="n">cnty</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cdct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cdct</span> <span class="k">else</span> <span class="n">cdct</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">cntz</span> <span class="o">=</span> <span class="p">(</span><span class="n">cntz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span> <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cdct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cdct</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnto</span> <span class="o">=</span> <span class="p">(</span><span class="n">cnto</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">key</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">lsls</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lgnd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z [m]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ykey</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ykey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ykey</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">ykey</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ref_&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ykey</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ykey</span>

        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ldct</span><span class="p">[</span><span class="n">ylabel</span><span class="p">]</span> <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">in</span> <span class="n">ldct</span> <span class="k">else</span> <span class="n">ylabel</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">BeamState</span><span class="p">,</span> <span class="n">ykey</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">txt</span><span class="p">[</span><span class="n">u0</span><span class="p">:</span><span class="n">u1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span> <span class="o">+</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="PlotLat"><a class="viewcode-back" href="../../../plotlat.html#flame_utils.PlotLat">[docs]</a><span class="k">class</span> <span class="nc">PlotLat</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Lattice picture class from FLAME lattice file or FLAME Machine object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : str or callable</span>
<span class="sd">        File path of the lattic file (str) or FLAME Machine object (callable)</span>
<span class="sd">    output : str (None), optional</span>
<span class="sd">        Output file name. If defined, the lattice plot is generated automatically.</span>
<span class="sd">    auto_scaling : bool (True), optional</span>
<span class="sd">        Flag for y-axis scaling by strength of the optical elements</span>
<span class="sd">    starting_offset : float (0.0), optional</span>
<span class="sd">        Position offset of starting point in the lattice file</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    types : dict</span>
<span class="sd">        Element type list of the lattice. Each element type contains</span>
<span class="sd">        on-off &#39;flag&#39;, plotting &#39;color&#39;, and y-axis &#39;scale&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_scaling</span><span class="o">=</span><span class="kc">False</span> <span class="p">,</span> <span class="n">starting_offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_scaling</span> <span class="o">=</span> <span class="n">auto_scaling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_starting_offset</span> <span class="o">=</span> <span class="n">starting_offset</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lat</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">)</span> <span class="o">==</span> <span class="n">Machine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;source must be a file path of .lat or flame.Machine object&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rfcavity&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;rfcavity&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;solenoid&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;solenoid&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>    <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;quadrupole&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;quad&#39;</span><span class="p">,</span>     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;sextupole&#39;</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;sext&#39;</span><span class="p">,</span>     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span>   <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;sbend&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;bend&#39;</span><span class="p">,</span>     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>  <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;equad&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;e-quad&#39;</span><span class="p">,</span>   <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>   <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;edipole&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;e-dipole&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span>   <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;bpm&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;bpm&#39;</span><span class="p">,</span>      <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;m&#39;</span><span class="p">,</span>      <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;orbtrim&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;corr&#39;</span><span class="p">,</span>     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>  <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;stripper&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;stripper&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>      <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                      <span class="s1">&#39;marker&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;pm&#39;</span><span class="p">,</span>       <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>      <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
                      <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_scaling</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)):</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">conf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">prv_scl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]][</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
                    <span class="n">tmp_scl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_scl</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]][</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">prv_scl</span><span class="p">,</span><span class="n">tmp_scl</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_scl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get arbital strength of the optical element.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scl</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rfcavity&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;scl_fac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">360.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;solenoid&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadrupole&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;B2&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;B2&#39;</span> <span class="ow">in</span> <span class="n">elem</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sextupole&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;B3&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sbend&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;equad&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;edipole&#39;</span><span class="p">:</span>
            <span class="n">scl</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">scl</span>


<div class="viewcode-block" id="PlotLat.generate"><a class="viewcode-back" href="../../../plotlat.html#flame_utils.PlotLat.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycen</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yscl</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                 <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate matplotlib Axes class object from lattice file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int</span>
<span class="sd">            Index of the lattice start.</span>
<span class="sd">        end : int</span>
<span class="sd">            Index of the lattice end.</span>
<span class="sd">        xlim : list[2], optinal</span>
<span class="sd">            Plot range of the lattice.</span>
<span class="sd">        ycen : float (0.0)</span>
<span class="sd">            Vertical offset of the plot.</span>
<span class="sd">        yscl : float (1.0)</span>
<span class="sd">            Plot scale of the element size</span>
<span class="sd">        aspect : float (5.0), optional</span>
<span class="sd">            Aspect ratio of the picture.</span>
<span class="sd">        legend : bool</span>
<span class="sd">            Add legend for the elements.</span>
<span class="sd">        option : bool</span>
<span class="sd">            Add optional setting for the plot.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        axes : callable</span>
<span class="sd">            Axes class object of matplotlib.</span>

<span class="sd">        total_length : float</span>
<span class="sd">            Total length of the lattice.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_starting_offset</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">ycen</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">))[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">foundelm</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">conf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">dL</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">dL</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]]</span>

                <span class="k">if</span> <span class="n">foundelm</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">foundelm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">legend</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">dL</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">bpp</span> <span class="o">=</span> <span class="n">bp</span>
                        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">ht</span> <span class="o">=</span> <span class="n">yscl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_scl</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">/</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.05</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ht</span> <span class="o">=</span> <span class="n">yscl</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_scl</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rfcavity&#39;</span> <span class="ow">or</span> <span class="n">elem</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;solenoid&#39;</span><span class="p">:</span>
                            <span class="n">bpp</span> <span class="o">=</span> <span class="n">bp</span><span class="o">-</span><span class="n">yscl</span><span class="o">*</span><span class="mf">0.7</span>
                            <span class="n">ht</span> <span class="o">=</span> <span class="n">yscl</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="mf">0.7</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ptc</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span> <span class="n">bpp</span><span class="p">),</span> <span class="n">dL</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span>
                                                           <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lin</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span><span class="n">pos</span><span class="p">],[</span><span class="o">-</span><span class="n">yscl</span><span class="o">*</span><span class="mf">0.3</span><span class="o">+</span><span class="n">bp</span><span class="p">,</span> <span class="n">yscl</span><span class="o">*</span><span class="mf">0.3</span><span class="o">+</span><span class="n">bp</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]))</span>

            <span class="n">pos</span> <span class="o">+=</span> <span class="n">dL</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_length</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lin</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pos</span><span class="p">],</span> <span class="p">[</span><span class="n">bp</span><span class="p">,</span><span class="n">bp</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">5</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">foundelm</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="p">:</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">foundelm</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">foundelm</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="p">:</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">foundelm</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xlim</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">ancscl</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">ancscl</span> <span class="o">=</span> <span class="n">pos</span>

            <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">ancscl</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotLat.output"><a class="viewcode-back" href="../../../plotlat.html#flame_utils.PlotLat.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Output the lattice picture to window and/or file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : bool (True)</span>
<span class="sd">            Output flag to the window.</span>
<span class="sd">        fname : str, optional</span>
<span class="sd">            File path of the output picutre.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            The same kwargs as pyplot.savefig() are available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;First argument must be a lattice file.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Second argument must be a output file name.&#39;</span><span class="p">)</span>

    <span class="n">pl</span> <span class="o">=</span> <span class="n">PlotLat</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2020, Facility for Rare Isotope Beams, Michigan State University.
      <span class="lastupdated">Last updated on Sep 14, 2021.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>